<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>合同查询</title>
<link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/default/easyui.css"/>
<link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/icon.css"/>
<link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/demo/demo.css"/>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="/static/js/date.js"></script>
	<script type="text/javascript" src="/static/js/basicFun.js"></script>
	<script type="text/javascript" src="/static/layer/layer.js"></script>
<script type="text/javascript">

	$(function(){
//		searchContract();
//		openAddContract();


		$("#dg").datagrid({
			//双击事件
			onDblClickRow: function (index, row) {
				$("#saveAndAddNextBuuton").hide();
				$("#dlg4").dialog("open").dialog("setTitle","合同详情");
				$("#fm4").form("load",row);
				var signer = "";
				for(var i = 0; i < row.signer.length; i++){
					signer += row.signer[i].merchantName+" ";
//					signer += row.signer[i].merchantName+"("+row.signer[i].merchantPhone+")";
				}
				$("#showsigner").val(signer);
				$("#sellingPrice").val("￥"+row.sellingPrice);
				$("#price").numberbox("setValue",row.price);
				$("#num").numberbox("setValue",row.num);
//				$("#num").focus();
//				$("#action").val("modify");
//				$("#rowIndex").val($("#dg").datagrid("getRowIndex",row));
			}
		});

		$("#dg3").datagrid({
			//双击事件
			onDblClickRow: function (index, row) {
				chooseSelectMerchant();
			}
		});

		$("#dg_benefic_list").datagrid({
			//双击事件
			onDblClickRow: function (index, row) {
				chooseSelectBenefic();
			}
		});

	})

	function openCalculateBacRent(contractId,detail){
		$("#bacrent").dialog("open").dialog("setTitle","返租明细" +contractId+
			"(合同编号："+detail+")");
		calculateBackRent(contractId);
	}

	function calculateBackRent(contractId){
		$('#merchant').val("");
		$('#total').val("");
		clearGrid("bacrentdetail");
//		contractId = 1;
		$('#selectedId').val(contractId);
		if($('#month').val().length==0 && $('#year').val().length>0){
			calYearRent(contractId,$('#period').val(),$('#year').val())
		}else if($('#year').val().length==0 && $('#period').val().length > 0){
			calPeriodRent(contractId,$('#period').val());
		}else if($('#month').val().length>0 && $('#year').val().length>0){
			calMonthRent(contractId,$('#period').val(),$('#year').val(),$('#month').val())
		}else{
			calBasicRent(contractId);
		}

	}
	function calBasicRent(contractId){
		$.ajax({
			url: '/api/v1/cal_basic_rent/'+contractId,
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {
				$('#merchant').val(data.merchantName);
				$('#total').val(data.total);
				var calRes = "";
				for(var i = 0; i<data.periodSumPayments.length;i++) {
					calRes +="第"+	data.periodSumPayments[i].periodInfo.period + "个租赁期（" +data.periodSumPayments[i].periodInfo.duration+"年）   从" +
							getMoth(data.periodSumPayments[i].rentStartPayTime)+"到" + getMoth(data.periodSumPayments[i].rentEndPayTime)+
							"    合计"+data.periodSumPayments[i].months + "个自然月，每12个月为一周期，"+
							"每周期前11个月每月应支付"+ data.periodSumPayments[i].elevenMonthAmount +"元 " +
							"   第12个月应支付"+data.periodSumPayments[i].lastMonthAmount+"元 " +
							"   总计"+fmoney(data.periodSumPayments[i].periodTotal,0)+"元\n"
				}
				calRes += "总租赁期总结支付"+ data.total +"元"
				document.getElementById('calRes').value=calRes;
				for(var i =0; i < data.result.length; i++){
					$('#bacrentdetail').datagrid('appendRow', {
						period:data.result[i].calDtail.period,
						duration:data.result[i].calDtail.duration,
						proportion:data.result[i].calDtail.proportion,
						date:getMoth(data.result[i].date),
						amount:data.result[i].amount
					});
				}
			},
			error: function () {
				alert('不可計算，請完善信息')
			}
		})
	}
	function calPeriodRent(contractId,period){
		$.ajax({
			url: '/api/v1/cal_period_basic_rent?contractId=' + contractId + '&period='+period,
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {
				$('#merchant').val(data.merchantName);
				$('#total').val(data.periodTotal);
				for(var i =0; i < data.periodResult.length; i++){
					$('#bacrentdetail').datagrid('appendRow', {
						period:data.periodResult[i].calDtail.period,
						duration:data.periodResult[i].calDtail.duration,
						proportion:data.periodResult[i].calDtail.proportion,
						date:getMoth(data.periodResult[i].date),
						amount:data.periodResult[i].amount
					});
				}
			},
			error: function () {
				alert('An error has occured!! :-(')
			}
		})
	}
	function calYearRent(contractId,period,year){
		$.ajax({
			url: '/api/v1/cal_year_basic_rent?contractId=' + contractId + '&year='+year,
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {
				$('#merchant').val(data.merchantName);
				$('#total').val(data.yearTotal);
				for(var i =0; i < data.yearResult.length; i++){
					$('#bacrentdetail').datagrid('appendRow', {
						period:data.yearResult[i].calDtail.period,
						duration:data.yearResult[i].calDtail.duration,
						proportion:data.yearResult[i].calDtail.proportion,
						date:getMoth(data.yearResult[i].date),
						amount:data.yearResult[i].amount
					});
				}
			},
			error: function () {
				alert('An error has occured!! :-(')
			}
		})
	}
	function calMonthRent(contractId,period,year,month){
		var date = new Date();
		date.setYear(year);
		date.setMonth(month);
		$.ajax({
			url: '/api/v1/cal_month_basic_rent?contractId=' + contractId + '&date='+date.getTime(),
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {
				$('#merchant').val(data.merchantName);
				$('#total').val(data.monthResult.amount);

					$('#bacrentdetail').datagrid('appendRow', {
						period:data.monthResult.calDtail.period,
						duration:data.monthResult.calDtail.duration,
						proportion:data.monthResult.calDtail.proportion,
						date:getMoth(data.monthResult.date),
						amount:data.monthResult.amount
					});
			},
			error: function () {
				alert('An error has occured!! :-(')
			}
		})
	}
	function searchContract(){
		var tableObj = document.getElementById("contract_detail");
		tableObj.innerHTML="";
//		clearGrid("dg");
		var geturl = "/api/v1/contracts?test=test";
		if($("#filterStartTime").datebox("getValue")!=""){
			geturl+="&filterStartTime="+dateToLong($("#filterStartTime").datebox("getValue"));
		}
		if($("#filterEndTime").datebox("getValue")!=""){
			geturl+="&filterEndTime="+dateToLong($("#filterEndTime").datebox("getValue"));
		}
		if($("#contractVersion").val()!=""){
			geturl+="&contractVersion="+$("#contractVersion").val();
		}
//		if($("#buildingStartSize").val()!=""){
//			geturl+="&buildingStartSize="+$("#buildingStartSize").val();
//		}
//		if($("#buildingEndSize").val()!=""){
//			geturl+="&buildingEndSize="+$("#buildingEndSize").val();
//		}
		if($("#signMode").val()!=""){
			geturl+="&signMode="+$("#signMode").val();
		}
		if($("#contractStatus").val()!=""){
			geturl+="&contractStatus="+$("#contractStatus").val();
		}
		if($("#beneficiaryName").val()!=""){
			geturl+="&beneficiaryName="+$("#beneficiaryName").val();
		}
		if($("#beneficiaryPhone").val()!=""){
			geturl+="&beneficiaryPhone="+$("#beneficiaryPhone").val();
		}


		$.ajax({
			url: geturl,
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {

				if (Object.keys(data).length > 0) {

//					var tableObj = $("#contract_detail");
					tableObj.innerHTML="";

					for(var i = 0; i < data.length; i++) {

						var trObj = document.createElement("div");
						var title = "";
						title += "合同编号："+data[i].contract.contractNo+"&nbsp;&nbsp;&nbsp;&nbsp;";
						title += "&nbsp;签约日期："+getMoth(data[i].contract.signingDate)+"&nbsp;&nbsp;&nbsp;&nbsp;";
						title += "   受益人："+data[i].contract.beneficiary.merchantName+"("+data[i].contract.beneficiary.merchantPhone+")"+"&nbsp;&nbsp;&nbsp;&nbsp;";
						title += "预计总返租金额："+data[i].total+"元";
						var content = "";
						var content1 = "第1期首月税后返租金额："+data[i].firstMonthBasicRentResult.planPayCountPost+"&nbsp;&nbsp;返租日期"+getMonth(data[i].firstMonthBasicRentResult.planPayDate)+"&nbsp;&nbsp;&nbsp;&nbsp;"
						var content2 = "";
						for(var j = 0; j < data[i].extendMonthRentResults.length; j++){
							var k = Number(j)+2;
							content2 += "第" + k +"期首月税后返租金额"+data[i].extendMonthRentResults[j].planPayCountPost+"&nbsp;&nbsp;返租日期"+getMonth(data[i].extendMonthRentResults[j].planPayDate)+"&nbsp;&nbsp;&nbsp;&nbsp;"

						}
						var content3 = "";
						for(var j = 0; j < data[i].normalMonthBasicRentResults.length; j++){
							var k = Number(j)+1;
							content3 += "<p>第" + k +"期税后平均每月支付"+data[i].normalMonthBasicRentResults[j].planPayCountPost+"&nbsp;&nbsp;返租日期从"+getMonth(data[i].normalMonthBasicRentResults[j].startTime) + "到"+getMonth(data[i].normalMonthBasicRentResults[j].endTime)+"</p>"
//							content3 += "第" + k +"期税后平均每月支付"+data[i].normalMonthBasicRentResults[j].planPayCountPost+"&nbsp;&nbsp;返租日期从"+getMonth(data[i].normalMonthBasicRentResults[j].startTime) + "到"+getMonth(data[i].normalMonthBasicRentResults[j].endTime)+"&nbsp;&nbsp;&nbsp;&nbsp;"

						}
						var content4 = "末月税后返租金额："+data[i].lastMonthBasicRentResult.planPayCountPost+"&nbsp;&nbsp;返租日期"+getMonth(data[i].lastMonthBasicRentResult.planPayDate)+"&nbsp;&nbsp;&nbsp;&nbsp;"
//						var content5 = "合计："+data[i].total+"元";
//						var content += "最后一月税后返租金额"
						trObj.innerHTML =
								"<div class='easyui-accordion accordion' data-options='multiple:true' style='width: 1020px;padding:10px;border:none;'>" +
								"<div class='panel' style='width: 1048px;'>" +
								"<div class='panel-header accordion-header accordion-header-selected' style='width: 1038px;'>" +
								"<div class='panel-title'>" +
								title +
								"</div><div class='panel-tool'>" +
								"<a class='accordion-collapse' href='javascript:void(0)'>" +
								"</a></div></div>" +
								"<div title='' style='overflow: visible; padding: 10px; display: block; width: 1028px; height: auto;' class='panel-body accordion-body'>" +
								"<p>" +
								content1 +
//								"</p>" +
//								"<p>" +
								content2 +
								"</p>" +
								"<p>" +
								content3 +
								"</p>" +
								"<p>" +
								content4 +
								"</p>" +
								"</div></div></div>"
						tableObj.appendChild(trObj);

					}
				} else {
//					alert("datasizeis0");

				}
				layer.msg('查询到'+data.length+'条记录');
			},
			error: function () {
				alert('An error has occured!! :-(')
			}
		})
	}


	function editContract(){
//		$('#buildingInfo').prop("disabled",false);
//		$('#buildingInfo').removeAttr("disabled");
//		$('#buildingInfo').removeAttr("readonly");
//		document.getElementById("id").disabled = "false";
		$('#buildingInfo').prop("disabled","disabled");
	}
	function updateContract(){
		$('#buildingInfo').removeProp("disabled");
//		$('#buildingInfo').attr("disabled",true);
//		$('#buildingInfo').attr("readonly","readonly");
//		document.getElementById("id").disabled = "true";
	}
	function download(){
		$.ajax({
			url: '/api/v1/download-contracts',
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {
				alert("downing")
			},
			error: function () {
				alert('An error has occured!! :-(')
			}
		})

	}
	function openAddContract(){
		$("#addcontract").dialog("open").dialog("setTitle","新增");
		$("#apayStartDate").datebox("setValue",genTodayStr());
		$("#apaybackDate").datebox("setValue",genTodayStr());
		$("#asigningDate").datebox("setValue",genTodayStr());
		$("#asubscriptionDate").datebox("setValue",genTodayStr());
	}
	function openAddContracts(){
		$("#addcontracts").dialog("open").dialog("setTitle","批量导入");


	}
	function addContract(){

		var contractinfo = $('#fm6').serializeArray();
		var contractobj = {};
		$.each(contractinfo,function(i,v){
			if(v.name.indexOf('Date')>0){
				var d = new Date(),
				dArr = v.value.split('-');
				d.setYear(dArr[0]);
				d.setMonth(dArr[1] - 1);
				d.setDate(dArr[2]);
				contractobj[v.name.substring(1)] = d.getTime();
			}else{
				contractobj[v.name.substring(1)] = v.value;
			}

		})
		contractobj['logs']='mylog';
		//getsigner

//		var jsonObj = JSON.parse(contractobj);
		var signerList = [];
		var item = $( '#selectedMerchants').datagrid('getRows');
		if (item) {
			for (var i = item.length - 1; i >= 0; i--) {
				signerList.push(JSON.parse(item[i].selectedMechanDetail));
			}
		}
		contractobj['signer']=signerList;
		//getbeneficiary
		var beneficList = [];
		var item = $( '#dg_benefic_selected').datagrid('getRows');
		if (item) {
			for (var i = item.length - 1; i >= 0; i--) {
				beneficList.push(JSON.parse(item[i].selectedMechanDetail));
			}
		}
		contractobj['beneficiary']=beneficList[0];
		if(!$("#fm6").form("validate")){
			return false;
		}else {
			$.ajax({
				url: '/api/v1/contracts',
				type: 'PUT',
				data: JSON.stringify(contractobj),
				contentType: 'application/json',
				success: function (data) {
					$.messager.alert('合同添加成功','')
					closeAddContract();
//					window.location.reload();
				},
				error: function (data) {
					$.messager.alert('合同添加失败',data.responseJSON.errorMessage)
				}
			})
		}
	}
	function closeAddContract(){
		$("#addcontract").dialog("close");
		resetMerchant();
	}
	function openChooseMerchant(){
		clearGrid("dg3");
		$("#dlg").dialog("open").dialog("setTitle","选择签约人");
		$("#s_codeOrName").focus();
	}
	function openChooseBenefic(){
		clearGrid("dg_benefic_list");
		$("#dg_benefic").dialog("open").dialog("setTitle","选择受益人");
	}
	function searchMerchant(name,type){
		//清除之前搜索出来的商户信息
		clearGrid("dg3");
		clearGrid("dg_benefic_list");
		var url = '/api/v1/merchants'
		if(name!=""){
			url += "?merchantName" + name;
		}
		$.ajax({
			url: url,
			type: 'GET',
			contentType: 'application/json',
			success: function (data) {
				if (data.length > 0) {
					var appendID = type=='merchant'?'dg3':'dg_benefic_list';
					for(var i = 0; i<=data.length;i++) {
						$('#'+appendID).datagrid('appendRow', {
							id:data[i].id,
							merchantName: data[i].merchantName,
							merchantPhone: data[i].merchantPhone,
							merchantIdNo: data[i].merchantIdNo,
							bankInfo: data[i].bankInfo,
							bankAccount: data[i].bankAccount,
							merchantAddress: data[i].merchantAddress
						});
					}
				} else {
					$.messager.alert("查询失败","未查询到 "+name+" 的相关信息");
				}
				if(type=='merchant'){
					$("#s_codeOrName").focus();
				}
				if(type=='benefic'){
					$("#s_codeOrName_benefic").focus();
				}

			},
			error: function () {
				alert('An error has occured!! :-(')
			}
		})
	}
	function addMerchant(){

		$.ajax({
			url: '/api/v1/merchants',
			type: 'PUT',
			data: "{"+
			"\"merchantName\":\""+$("#newMerchantName").val()+"\","+
			"\"merchantPhone\":\""+$("#newMmerchantPhone").val()+"\","+
			"\"merchantIdNo\":\""+$("#newMmerchantIdNo").val()+"\""+
//			"\"bankInfo\":\""+$("#newBankInfo").val()+"\","+
//			"\"bankAccount\":\""+$("#newBankAcount").val()+"\","+
//			"\"merchantAddress\":\""+$("#newMerchnatAddress").val()+"\""+
			"}",
			contentType: 'application/json',
			success: function (data) {
				$.messager.alert("添加成功","添加成功");
			},
			error: function () {
				$.messager.alert("添加失败","该商户已存在");
			}
		})
	}
	function addBenefit(){

		$.ajax({
			url: '/api/v1/merchants',
			type: 'PUT',
			data: "{"+
			"\"merchantName\":\""+$("#bnewMerchantName").val()+"\","+
			"\"merchantPhone\":\""+$("#bnewMmerchantPhone").val()+"\","+
			"\"merchantIdNo\":\""+$("#bnewMmerchantIdNo").val()+"\","+
			"\"bankInfo\":\""+$("#bnewBankInfo").val()+"\","+
			"\"bankAccount\":\""+$("#bnewBankAcount").val()+"\","+
			"\"merchantAddress\":\""+$("#bnewMerchnatAddress").val()+"\""+
			"}",
			contentType: 'application/json',
			success: function (data) {
				$.messager.alert("添加成功","添加成功");
			},
			error: function () {
				$.messager.alert("添加失败","该商户已存在");
			}
		})
	}
	function openAddMerchant(){
		$("#addMerchant").dialog("open").dialog("setTitle","添加签约人");
	}
	function openAddBenefit(){
		$("#addBenefit").dialog("open").dialog("setTitle","添加受益人");
	}
	function chooseSelectMerchant(){
//		$("#saveAndAddNextBuuton").show();
		var selectedRows=$("#dg3").datagrid("getSelections");
		if(selectedRows.length!=1){
			$.messager.alert("系统提示","请选择一个商户！");
			return;
		}
		var row=selectedRows[0];
		var item = $( '#selectedMerchants').datagrid('getRows');
		if (item) {
			for (var i = item.length - 1; i >= 0; i--) {
				if(item[i].id==row.id){
					$.messager.alert("重复添加","已添加该项");
					return;
				}
			}
		}
		$('#selectedMerchants').datagrid('appendRow', {
			id: row.id,
			selectedMercahnt: row.merchantName,
//			selectedMercahnt: row.merchantName+"("+row.merchantPhone+")",
			selectedMechanDetail: JSON.stringify(row)
		});
//		$("#dlg4").dialog("open").dialog("setTitle","选择商户品");
//		$("#fm4").form("load",row);
//		$("#sellingPrice").val("￥"+row.sellingPrice);
//		$("#price").numberbox("setValue",row.sellingPrice);
//		$("#num").focus();
//		$("#action").val("add");

	}
	function chooseSelectBenefic(){
		var selectedRows=$("#dg_benefic_list").datagrid("getSelections");
		if(selectedRows.length!=1){
			$.messager.alert("系统提示","请选择一个受益人！");
			return;
		}
		var row=selectedRows[0];
		var item = $( '#dg_benefic_selected').datagrid('getRows');
		if (item) {
			for (var i = item.length - 1; i >= 0; i--) {
				$.messager.alert("重复添加","受益人只能有一个");
				return;
			}
		}
		$('#dg_benefic_selected').datagrid('appendRow', {
			id: row.id,
			selectedMercahnt: row.merchantName+"("+row.merchantPhone+")",
			selectedMechanDetail: JSON.stringify(row)
		});

	}
	function updateMerchantNum(){
		var merchantNameval = '';
		var item = $('#selectedMerchants').datagrid('getRows');
		for(var i = item.length-1;i>=0;i--){
			merchantNameval += item[i].selectedMercahnt+' ';
		}
//		var merchantNameval = "已选" + $( '#selectedMerchants').datagrid('getRows').length + "人";
		$("#asigner").val(merchantNameval)
	}
	function updateBeneficVal(){
		var row =  $( '#dg_benefic_selected').datagrid('getRows');
		var beneficVal = '';
		if(row.length>0){
			beneficVal = row[0].selectedMercahnt;
		}
		$("#abeneficiary").val(beneficVal)
	}
	function deleteSelected(gridId){
		var selectedRows=$( '#'+gridId).datagrid("getSelections");
		var row = selectedRows[0];
		var index = $( '#'+gridId).datagrid("getRowIndex",row);
		$( '#'+gridId).datagrid('deleteRow', index);
	}
	function doUpload() {
		var formData = new FormData($( "#uploadForm" )[0]);
		$.ajax({
			url: '/api/v1/upload-contracts' ,
			type: 'POST',
			data: formData,
			async: false,
			cache: false,
			contentType: false,
			processData: false,
			success: function (returndata) {
				$.messager.alert("上传成功",'');
				$("#addcontracts").dialog("close");
			},
		error: function (returndata) {
			$.messager.alert("上传失败",returndata);
			$("#addcontracts").dialog("close");
		}
		});
	}

	function collapspan(){
		$(".easyui-accordion .panel-header").click();
	}

	function resetMerchant(){
		clearGrid("selectedMerchants");
		clearGrid("dg_benefic_selected");
	}
</script>
</head>
<body class="easyui-layout" style="margin: 1px">
<div region="north"  style="height: 130px;">
	<div style="padding: 5px">
		<fieldset style="border-color: #E7F0FF">
			<legend>查询设置</legend>
			<table align="center" width="100%">
				<tr>
					<td style="width: 8%;">合同版本：</td>
					<td style="width: 17%;"><select type="text" id="contractVersion" name="contractVersion" style="width: 80%">
						<option value="">所有版本</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
					</select></td>
					<td style="width: 8%;">签约日期：</td>
					<td  style="width: 20%;"><input type="text" id="filterStartTime" name="filterStartTime"  style="width: 84%" class="easyui-datebox"/>-<input type="text" id="filterEndTime" name="filterEndTime" style="width: 84%" class="easyui-datebox"/></td>
					<!--<td style="width: 8%;">建筑面积：</td>-->
					<!--<td style="width: 10%;"><input type="text" id="buildingStartSize" name="buildingStartSize" style="width: 40%"/>-<input type="text" id="buildingEndSize" name="buildingEndSize" style="width: 40%"/></td>-->
					<td style="width: 8%;">房号信息：</td>
					<td  style="width: 10%;"><input type="text" id="buildingInfo" name="buildingInfo" style="width: 90%"/></td>
					<!--<td>房号信息：<input type="text" id="buildingInfo" name="buildingInfo" style="width: 22%"/></td>-->
					<td></td>
				</tr>
				<tr>
					<!--<td>签约方式：<select type="text" id="signMode" name="signMode" style="width: 175px;" >-->
					<td style="width: 8%;">合同状态：</td>
					<td><select type="text" id="contractStatus" name="contractStatus" style="width: 80%" >
						<option value="">所有状态</option>
						<option value="UNSTARTED">未开始</option>
						<option value="PENDINGRENTAL">已签约，市场培育期</option>
						<option value="RENTAL">已签约，返租期</option>
						<option value="NORMALEND">正常结束</option>
						<option value="ABNORMALEND">非正常结束</option>
					</select></td>
					<td>签约方式：</td>
					<td><select type="text" id="signMode" name="signMode" style="width: 72%" >
						<option value="">所有方式</option>
						<option value="MORTGAGE">按揭贷款</option>
						<option value="DISPOSABLE">一次性</option>
					</select></td>

					<td>受益人电话:</td>
					<td><input type="text" id="beneficiaryPhone" name="beneficiaryPhone" style="width: 90%"/></td>
					<td align="center" ></td>

				</tr>
				<tr>
					<td>合同编号:</td>
					<td><input type="text" id="contractNo" name="contractNo" style="width: 80%"/></td>
					<td>受益人姓名:</td>
					<td><input type="text" id="beneficiaryName" name="beneficiaryName" style="width: 70%"/></td>

					<td style="width: 30%;" colspan="3">
						<a href="javascript:searchContract()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
						<!--<a href="javascript:collapspan()" class="easyui-linkbutton" iconCls="icon-search" plain="true">展开/收起所有</a>-->
						<a href="javascript:openAddContract()" class="easyui-linkbutton" iconCls="icon-add" plain="true">新增记录</a></td>
					</td>

				</tr>
			</table>
		</fieldset>

	</div>

</div>
<div id="contract_detail" region="center" title="" style='overflow:scroll;'>

<!--(搜索出来的合同动态加载至此)-->
<!--<div>-->
	<!--<div class='easyui-accordion' data-options='multiple:true' style='width:1080px;heightl:100px;padding:10px; border: none;'>-->
	<!--<div title='合同编号：NO01     签约日期：2015-8-24     受益人：张三(1399xxxx297)    预计总返租金额：3445648.69元' style='overflow:visible;padding:10px;'>-->
		<!--<p>共3期，预计支付3445648.69元</p>-->
		<!--<p>已支付至第2期第4个自然月（2018-1)</p>-->
		<!--<p>已支付****元</p>-->
		<!--<p>还剩余****元</p>-->
		<!--</div>-->
	<!--</div>-->
<!--</div>-->

</div>

  <div id="dlg2" class="easyui-dialog" style="width:180px;height:300px;padding: 10px 10px;top: 52px;left: 80px"
   closed="true" buttons="#dlg-buttons2">
   
   	<ul id="typeTree" class="easyui-tree"></ul>
   
  </div>

<div id="dlg4" class="easyui-dialog" style="width:650px;height:450px;padding: 5px 5px"
	 closed="true" buttons="#dlg-buttons4" data-options="onClose:function(){resetMerchant()}">

	<fieldset style="border-color: #E7F0FF">
		<legend>详细信息</legend>
		<form id="fm4" name="fm4" method="post">
			<table cellspacing="6px">
				<tr>
					<td>所在区域&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<select type="text" name="region"  style="width: 170px;" >
						<option value="22">22</option>
						<option value="23">23</option>
					</select></td>
					<td>合同编号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="contractNo" class="easyui-validatebox" required="true"/></td>
				</tr>
				<tr>
					<td>合同版本&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<select type="text" name="contractVersion" style="width: 170px;" required="true">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
					</select></td>
					<td>认购日期&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="subscriptionDate" size="20" class="easyui-datebox" data-options="editable:false"/></td>

				</tr>
				<tr>
					<td>签约日期&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="signingDate" size="20" class="easyui-datebox" data-options="editable:false" /></td>
					<td>楼层房号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="buildingInfo" class="easyui-validatebox" /></td>
				</tr>
				<tr>
					<td>建筑面积(m2)：<input type="text" name="buildingSize" class="easyui-validatebox" required="true"/></td>
					<td>签约人&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input id="showsigner" type="text" name="signer" class="easyui-validatebox" required="true"  onclick="openChooseMerchant()"  disabled="disabled"/></td>
				</tr>
				<tr>
					<td>销售原价(元)&nbsp;&nbsp;：<input type="text" name="originalPrice" class="easyui-validatebox" /></td>
					<td>总价(元)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="totalPrice" class="easyui-validatebox" /></td>
				</tr>
				<tr>
					<td>签约总价(元)&nbsp;&nbsp;：<input type="text" name="signTotalPrice" class="easyui-validatebox" /></td>
					<td>返租基价(元)：<input type="text" name="leasebackPrice" class="easyui-validatebox" required="true"/></td>
				</tr>
				<tr>
					<td>记租起始日&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="payStartDate" size="20" class="easyui-datebox" data-options="editable:false" required="true"/></td>
					<td>回款时间&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="paybackDate" size="20" class="easyui-datebox" data-options="editable:false" required="true"/></td>
				</tr>
				<tr>
					<td>返租溢价(元)&nbsp;&nbsp;：<input type="text" name="backPremium" class="easyui-validatebox" disabled="disabled"/></td>
					<td>合同期&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input type="text" name="contractTerDate" size="20" class="easyui-datebox" data-options="editable:false" disabled="disabled" /></td>
				</tr>
				<tr>
					<td>合同状态&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<select type="text" name="contractStatus"  style="width: 170px;" >
						<option value="UNSTARTED">未开始</option>
						<option value="PENDINGRENTAL">已签约，市场培育期</option>
						<option value="RENTAL">已签约，返租期</option>
						<option value="NORMALEND">正常结束</option>
						<option value="ABNORMALEND">非正常结束</option>
					</select></td>
					<td>签约方式&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<select type="text" name="signingMode" style="width: 166px;" >
						<option value="MORTGAGE">按揭贷款</option>
						<option value="DISPOSABLE">一次性</option>
					</select></td>
				</tr>
				<tr>
					<td>方案选择&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<select type="text" name="proposalId" style="width: 170px;" required="true">
						<option value="1">方案一</option>
						<option value="2">方案二</option>
						<option value="3">方案三</option>
						<option value="4">方案四</option>
					</select></td>
					<td>受益人&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;：<input  type="text" name="beneficiary" class="easyui-validatebox" required="true" disabled="disabled"/></td>
				</tr>

			</table>

		</form>
	</fieldset>
	<div style="padding-left: 12px;padding-top: 10px">
		<form id="fm5" method="post">
			<table cellspacing="8px" align="center">
				<tr>
					<td>
						<input type="hidden" id="action"/>
						<input type="hidden" id="rowIndex"/>
					</td>
					<td><a href="javascript:editContract()" class="easyui-linkbutton"  iconCls="icon-edit">编辑</a></td>
					<td>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:updateContract()" class="easyui-linkbutton"  iconCls="icon-save">保存</a></td>
				</tr>
			</table>
		</form>
	</div>
</div>

<div id="bacrent" class="easyui-dialog" style="width:950px;height:420px;" closed="true">
	<div class="easyui-layout" style="width:100%;height:100%;">

		<div region="north" style="height: 160px;" >
			<div style="padding-top: 8px;padding-left: 10px;">
				<input type="number" id="selectedId" size="1" hidden="true"/>
				&nbsp;期：&nbsp;<input type="number" id="period" size="2" style="font-size:5px"/>
				&nbsp;年：&nbsp;<input type="number" id="year" size="2" style="font-size:5px"/>
				&nbsp;月：&nbsp;<input type="number" id="month" size="2" style="font-size:5px"/>
				<a class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="calculateBackRent($('#selectedId').val())">计算</a>

				<a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;商户：</a><input type="text" id="merchant" size="5" disabled="true"/>
				<a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;总计(元)：</a><input type="text" id="total" size="5" disabled="true"/>
			</div>
			<div>
				<fieldset style="border-color: #E7F0FF">
					<legend>查询结果</legend>
		<textarea id="calRes" style="width:100%;height:100%;" rows="5" readonly="true" >

		</textarea>
				</fieldset>
			</div>
		</div>
		<div region="center">
				<table id="bacrentdetail" title="每月返租详情"  class="easyui-datagrid" style="height: 1000px"
					   fitColumns="true"  rownumbers="true" singleSelect="true"
					   fit="true" toolbar="#tb">
				<thead>
				<tr>
					<th field="period" width="25" align="center">阶段(期)</th>
					<th hidden="true" field="duration" width="25" align="center">阶段持续时间</th>
					<th field="proportion" width="25" align="center">利率</th>
					<th field="date" width="25" align="center">计划返租时间</th>
					<th field="amount" width="25" align="center">计划返租金额(元)</th>
				</tr>
				</thead>
			</table>

		</div>
	</div>

</div>



<div id="addcontract" class="easyui-dialog" style="width:650px;height:380px;padding: 10px 20px"
	 closed="true" buttons="#dlg-buttons2"  data-options="onClose:function(){resetMerchant()}">
	<form id="fm6" name="fm6" method="post">
		<table cellspacing="6px">
			<tr>
				<td style="width: 15%">所在区域&nbsp;：</td>
				<td style="width: 25%"><select type="text" id="aregion" name="aregion"  style="width: 81%" >
					<option value="22">22</option>
					<option value="23">23</option>
				</select></td>
				<td style="width: 15%">合同编号&nbsp;：</td>
				<td style="width: 25%"><input value="No01" type="text" id="acontractNo" name="acontractNo" style="width: 80%" class="easyui-validatebox" required="true"/></td>
			</tr>
			<tr>
				<td>合同版本&nbsp;：</td>
				<td><select type="text" id="acontractVersion" name="acontractVersion" style="width: 81%" required="true">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
				</select></td>
				<td>认购日期&nbsp;：</td>
				<td style="width: 25%"><input type="text" id="asubscriptionDate" name="asubscriptionDate" style="width: 140%" class="easyui-datebox" data-options="editable:false"/></td>

			</tr>
			<tr>
				<td>签约日期&nbsp;：</td>
				<td><input type="text" id="asigningDate" name="asigningDate" style="width: 140%" class="easyui-datebox" data-options="editable:false" /></td>
				<td>楼层房号&nbsp;：</td>
				<td><input value="1层-商10" type="text" id="abuildingInfo" name="abuildingInfo" style="width: 79%" class="easyui-validatebox" /></td>
			</tr>
			<tr>
				<td>建筑面积(m2)：</td><td><input value="221.71" type="text" id="abuildingSize" name="abuildingSize" style="width: 79%" class="easyui-validatebox" /></td>
				<td>签约人&nbsp;：</td><td><input value="" type="text" id="asigner" name="asigner" style="width: 79%" class="easyui-validatebox" required="true"  onclick="openChooseMerchant()"  readonly="true"/></td>
			</tr>
			<tr>
				<td>销售原价(元)&nbsp;：</td><td><input value="5200" type="text" id="aoriginalPrice" name="aoriginalPrice" style="width: 79%" class="easyui-validatebox" /></td>
				<td>总价(元)&nbsp;：</td><td><input value="6000" type="text" id="atotalPrice" name="atotalPrice" style="width: 79%" class="easyui-validatebox" /></td>
			</tr>
			<tr>
				<td>签约总价(元)&nbsp;：</td><td><input value="5500" type="text" id="asignTotalPrice" name="asignTotalPrice" style="width: 79%" class="easyui-validatebox" /></td>
				<td>返租基价(元)：</td><td><input value="4877620" type="text" id="aleasebackPrice" name="aleasebackPrice" style="width: 79%" class="easyui-validatebox"/></td>
			</tr>
			<tr>
				<td>记租起始日&nbsp;：</td><td><input type="text" id="apayStartDate" name="apayStartDate" style="width: 140%" class="easyui-datebox" data-options="editable:false" /></td>
				<td>回款时间&nbsp;：</td><td><input type="text" id="apaybackDate" name="apaybackDate" style="width: 140%" class="easyui-datebox" data-options="editable:false" /></td>
			</tr>
			<tr>
				<td>签约状态&nbsp;：</td><td><select type="text" id="SigningStatus" name="SigningStatus"  style="width: 81%" >
					<option value="UNSIGNED">未签</option>
					<option value="SIGNED">已签</option>
				</select></td>
				<td>签约方式&nbsp;：</td><td><select type="text" id="asigningMode" name="asigningMode"   style="width: 81%" >
					<option value="MORTGAGE">按揭贷款</option>
					<option value="DISPOSABLE">一次性</option>
				</select></td>
			</tr>
			<tr>
				<td>方案选择&nbsp;：</td><td><select type="text" id="aproposalId" name="aproposalId"   style="width: 81%" required="true">
					<option value="1">方案一</option>
					<option value="2">方案二</option>
					<option value="3">方案三</option>
					<option value="4">方案四</option>
				</select></td>
				<td>受益人&nbsp;：</td><td><input value="" type="text" id="abeneficiary" name="abeneficiary" style="width: 79%" class="easyui-validatebox" required="true" onclick="openChooseBenefic()" readonly="true"/></td>
			</tr>
		</table>
	</form>
	<div id="ac-buttons" align="center">
		<a class="easyui-linkbutton" iconCls="icon-ok" onclick="addContract()">保存</a>
		<a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
		<a href="javascript:closeAddContract()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
		<a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
		<a href="javascript:openAddContracts()" class="easyui-linkbutton" iconCls="icon-folder">批量导入</a>
	</div>
</div>

<div id="addcontracts" class="easyui-dialog" style="width:450px;height:100px;padding: 10px 10px"
	 closed="true">
	<div  align="center">
		<form id= "uploadForm">
			 <input type="file" name="contracts"/><input type="button" value="上传" onclick="doUpload()" />
		</form>
	</div>
</div>


<div id="dlg" class="easyui-dialog" style="width:800px;height:420px;"
	 closed="true" data-options="onClose:function(){updateMerchantNum()}" >
	<div class="easyui-layout" style="width:100%;height:100%;">

		<div region="north" style="height: 50px;" >
			<div style="padding-top: 8px;padding-left: 40px;">
				&nbsp;签约人搜索：&nbsp;<input type="text" id="s_codeOrName" size="30" onkeydown="if(event.keyCode==13) searchMerchant($('#s_codeOrName').val(),'merchant')"/>
				<a class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="searchMerchant($('#s_codeOrName').val(),'merchant')">搜索</a>
				<a class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="openAddMerchant()">添加新商户</a>
			</div>
		</div>
		<div region="west" style="width: 200px" title="已选签约人" split="true" data-options="collapsible:false">
			<table id="selectedMerchants" class="easyui-datagrid"
				   fitColumns="true" pagination="false" rownumbers="true" singleSelect="true" >
				<thead>
				<tr>
					<th field="id" width="30" hidden=true align="center">编号</th>
					<th field="selectedMercahnt" width="25" align="center">已选签约人</th>
					<th field="selectedMechanDetail" width="30" hidden=true align="center">详细信息</th>
				</tr>
				</thead>
			</table>
			<div style="position:absolute;bottom: 10px;" align="center">
				<a href="javascript:chooseSelectMerchant()" class="easyui-linkbutton" data-options="iconCls:'icon-ok'">添加</a>
				<a id="del" href="javascript:deleteSelected('selectedMerchants')" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">删除</a>
			</div>
		</div>
		<div region="center">
			<table id="dg3" title="签约人信息" class="easyui-datagrid"
				   fitColumns="true" pagination="false" rownumbers="true" singleSelect="true"
				    fit="true" toolbar="#tb3">
				<thead>
				<tr>
					<th field="id" width="30" hidden=true align="center">编号</th>
					<th field="merchantName" width="25" align="center">姓名</th>
					<th field="merchantPhone" width="30" align="center">电话</th>
					<th field="merchantIdNo" width="40" align="center">身份证</th>
					<th field="merchantAddress" width="60" align="center">通讯地址</th>
				</tr>
				</thead>
			</table>
		</div>
	</div>
</div>

<div id="dg_benefic" class="easyui-dialog" style="width:800px;height:420px;"
	 closed="true" data-options="onClose:function(){updateBeneficVal()}" >
	<div class="easyui-layout" style="width:100%;height:100%;">

		<div region="north" style="height: 50px;" >
			<div style="padding-top: 8px;padding-left: 40px;">
				&nbsp;受益人搜索：&nbsp;<input type="text" id="s_codeOrName_benefic" size="30" onkeydown="if(event.keyCode==13) searchMerchant($('#s_codeOrName_benefic').val(),'benefic')"/>
				<a class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="searchMerchant($('#s_codeOrName_benefic').val(),'benefic')">搜索</a>
				<a href="javascript:openAddBenefit()" class="easyui-linkbutton" data-options="iconCls:'icon-add'">添加新受益人</a>
			</div>
		</div>
		<div region="west" style="width: 200px" title="已选受益人" split="true" data-options="collapsible:false">
			<table id="dg_benefic_selected" class="easyui-datagrid"
				   fitColumns="true" pagination="false" rownumbers="true" singleSelect="true"
				    fit="false" >
				<thead>
				<tr>
					<th field="id" width="30" hidden=true align="center">编号</th>
					<th field="selectedMercahnt" width="25" align="center">已选受益人</th>
					<th field="selectedMechanDetail" width="30" hidden=true align="center">详细信息</th>
				</tr>
				</thead>
			</table>
			<div style="position:absolute;bottom: 10px;left: 4px">
				<a href="javascript:chooseSelectBenefic()" class="easyui-linkbutton" data-options="iconCls:'icon-ok'">添加</a>
				<a id="del_benefic" href="javascript:deleteSelected('dg_benefic_selected')" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">删除</a>
			</div>
		</div>
		<div region="center">
			<table id="dg_benefic_list" title="受益人" class="easyui-datagrid"
				   fitColumns="true" pagination="false" rownumbers="true" singleSelect="true"
				    fit="true" toolbar="#tb3">
				<thead>
				<tr>
					<th field="id" width="30" hidden=true align="center">编号</th>
					<th field="merchantName" width="25" align="center">姓名</th>
					<th field="merchantPhone" width="30" align="center">电话</th>
					<th field="merchantIdNo" width="40" align="center">身份证</th>
					<th field="merchantAddress" width="60" align="center">通讯地址</th>
				</tr>
				</thead>
			</table>
		</div>
	</div>


</div>

<div id="addMerchant" class="easyui-dialog" style="width:330px;height:200px;padding: 10px 20px"
	 closed="true" buttons="#dlg-buttons1"  data-options="onClose:function(){$('#goodsTypeName').val('');}">

	<table cellspacing="8px">
		<tr><td><div>商户姓名：&nbsp;<input value="张三" type="text" id="newMerchantName" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>商户电话：&nbsp;<input value="15688888888" type="text" id="newMmerchantPhone" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>身份证号：&nbsp;<input value="360424199999999999" type="text" id="newMmerchantIdNo" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
	</table>
</div>

<div id="dlg-buttons1">
	<a class="easyui-linkbutton" iconCls="icon-ok" onclick="addMerchant()">保存</a>
	<!--<a href="javascript:closeGoodsTypeDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>-->
</div>

<div id="addBenefit" class="easyui-dialog" style="width:330px;height:320px;padding: 10px 20px"
	 closed="true" buttons="#dlg-buttons2"  data-options="onClose:function(){$('#goodsTypeName').val('');}">

	<table cellspacing="8px">
		<tr><td><div>商户姓名：&nbsp;<input value="李四" type="text" id="bnewMerchantName" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>商户电话：&nbsp;<input value="15688888888" type="text" id="bnewMmerchantPhone" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>身份证号：&nbsp;<input value="360424199999999999" type="text" id="bnewMmerchantIdNo" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>开&nbsp;户&nbsp;&nbsp;行：&nbsp;<input value="建设银行" type="text" id="bnewBankInfo" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>支行信息：&nbsp;<input value="珞瑜东路支行" type="text" id="bnewBankBranch" name="bnewBankBranch" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>银行卡号：&nbsp;<input value="6227002020200008" type="text" id="bnewBankAcount" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
		<tr><td><div>通讯地址：&nbsp;<input value="湖北省武汉市" type="text" id="bnewMerchnatAddress" name="name" class="easyui-validatebox" required="true"/></div></td></tr>
	</table>
</div>

<div id="dlg-buttons2" align="center">
	<a class="easyui-linkbutton" iconCls="icon-ok" onclick="addBenefit()">保存</a>
	<!--<a href="javascript:closeGoodsTypeDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>-->
</div>

</body>
</html>